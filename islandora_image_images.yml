id: islandora_basic_image_images_json_over_rest
migration_group: 'Islandora 7.x Over REST'
label: 'Islandora 7.x JSON over REST (Images)'

source:
  plugin: url
  data_fetcher_plugin: http
  data_parser_plugin: json
  headers:
    Accept: 'application/json; charset=utf-8'
    Content-Type: application/json
  # You will need to modify this configuration value to include your own 7.x hostname, source collection PID, and content model.
  urls: 'http://digital.lib.sfu.ca/islandora/rest/v1/solr/RELS_EXT_isMemberOfCollection_uri_mt:"vpl:collection"&RELS_EXT_hasModel_uri_mt\:info:fedora/islandora:sp_basic_image?fl=PID,fgs_label_t&rows=10'
  item_selector: /response/docs/
  fields:
    -
      name: field_pid
      label: PID
      selector: PID
  ids:
    field_pid:
      type: string

process:
  remote_image_url:
     plugin: concat
     delimiter: /
     source:
       - 'http://digital.lib.sfu.ca/islandora/rest/v1/object'
       - field_pid
       - 'datastream/OBJ'
  temp_image_uri:
     plugin: concat
     delimiter: /
     source:
       - constants/image_base_dir
       - constants/image_name
  uri:
     plugin: download
     source:
       - '@remote_image_url'
       - '@temp_image_uri'
     rename: true
#  parent:
#     plugin: migration_lookup
#     migration: islandora_basic_image_json_over_rest
#     source: field_web_content

destination:
  plugin: 'entity:media'
  default_bundle: web_content
